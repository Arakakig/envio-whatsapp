<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Som de Notifica√ß√£o</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .audio-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        input[type="range"] {
            width: 200px;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîä Teste - Som de Notifica√ß√£o</h1>
        
        <div class="test-section">
            <h3>1. Verificar Suporte de √Åudio</h3>
            <button onclick="checkAudioSupport()">Verificar Suporte</button>
            <div id="audio-support-status" class="status"></div>
        </div>

        <div class="test-section">
            <h3>2. Testar Diferentes Caminhos de Som</h3>
            <button onclick="testAudioPath('/notification.mp3')">Testar /notification.mp3</button>
            <button onclick="testAudioPath('http://localhost:3001/notification.mp3')">Testar URL Completa</button>
            <button onclick="testAudioPath('./notification.mp3')">Testar ./notification.mp3</button>
            <div id="audio-path-status" class="status"></div>
        </div>

        <div class="test-section">
            <h3>3. Controles de √Åudio</h3>
            <div class="audio-controls">
                <label>Volume: <input type="range" id="volume-control" min="0" max="1" step="0.1" value="0.5"></label>
                <span id="volume-display">50%</span>
                <br>
                <button onclick="playNotificationSound()">Tocar Som de Notifica√ß√£o</button>
                <button onclick="stopAudio()">Parar √Åudio</button>
            </div>
            <div id="audio-controls-status" class="status"></div>
        </div>

        <div class="test-section">
            <h3>4. Teste de Notifica√ß√£o Completa</h3>
            <button onclick="testCompleteNotification()">Testar Notifica√ß√£o Completa</button>
            <div id="complete-test-status" class="status"></div>
        </div>

        <div class="test-section">
            <h3>5. Teste de T√≠tulo da P√°gina</h3>
            <button onclick="testTitleNotification()">Testar Notifica√ß√£o no T√≠tulo</button>
            <div id="title-test-status" class="status"></div>
        </div>

        <div class="test-section">
            <h3>üìã Log de Eventos</h3>
            <div id="event-log" class="log"></div>
        </div>
    </div>

    <script>
        let currentAudio = null;

        function log(message) {
            const logElement = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function checkAudioSupport() {
            const status = document.getElementById('audio-support-status');
            
            // Verificar Web Audio API
            if (window.AudioContext || window.webkitAudioContext) {
                status.innerHTML = '<div class="success">‚úÖ Web Audio API dispon√≠vel</div>';
                log('‚úÖ Web Audio API dispon√≠vel');
                
                // Testar cria√ß√£o de contexto de √°udio
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    status.innerHTML += '<div class="success">‚úÖ Contexto de √°udio criado com sucesso</div>';
                    log('‚úÖ Contexto de √°udio criado com sucesso');
                    
                    // Testar beep
                    const success = playNotificationBeep();
                    if (success) {
                        status.innerHTML += '<div class="success">‚úÖ Beep de teste funcionando</div>';
                        log('‚úÖ Beep de teste funcionando');
                    } else {
                        status.innerHTML += '<div class="error">‚ùå Beep de teste falhou</div>';
                        log('‚ùå Beep de teste falhou');
                    }
                } catch (err) {
                    status.innerHTML += `<div class="error">‚ùå Erro ao criar contexto de √°udio: ${err.message}</div>`;
                    log(`‚ùå Erro ao criar contexto de √°udio: ${err.message}`);
                }
            } else {
                status.innerHTML = '<div class="error">‚ùå Web Audio API n√£o dispon√≠vel</div>';
                log('‚ùå Web Audio API n√£o dispon√≠vel');
            }
            
            // Verificar Audio API tradicional
            if ('Audio' in window) {
                status.innerHTML += '<div class="info">‚ÑπÔ∏è Audio API tradicional dispon√≠vel</div>';
                log('‚ÑπÔ∏è Audio API tradicional dispon√≠vel');
            } else {
                status.innerHTML += '<div class="error">‚ùå Audio API tradicional n√£o dispon√≠vel</div>';
                log('‚ùå Audio API tradicional n√£o dispon√≠vel');
            }
        }

        function testAudioPath(path) {
            const status = document.getElementById('audio-path-status');
            log(`üîç Testando caminho: ${path}`);
            
            try {
                const audio = new Audio(path);
                const volume = document.getElementById('volume-control').value;
                audio.volume = volume;
                
                audio.addEventListener('loadstart', () => {
                    log(`üì• Iniciando carregamento: ${path}`);
                });
                
                audio.addEventListener('canplay', () => {
                    log(`‚úÖ √Åudio carregado com sucesso: ${path}`);
                    status.innerHTML = `<div class="success">‚úÖ √Åudio carregado: ${path}</div>`;
                });
                
                audio.addEventListener('error', (e) => {
                    log(`‚ùå Erro ao carregar √°udio: ${path} - ${e.target.error?.message || 'Erro desconhecido'}`);
                    status.innerHTML = `<div class="error">‚ùå Erro ao carregar: ${path}</div>`;
                });
                
                audio.load();
                
            } catch (err) {
                log(`‚ùå Erro ao criar √°udio: ${path} - ${err.message}`);
                status.innerHTML = `<div class="error">‚ùå Erro ao criar √°udio: ${path}</div>`;
            }
        }

        // Fun√ß√£o para tocar beep de notifica√ß√£o usando Web Audio API
        function playNotificationBeep() {
            try {
                // Criar contexto de √°udio
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Criar oscilador para gerar o som
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                // Configurar o som
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime); // Frequ√™ncia 800Hz
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Configurar volume e envelope
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                // Tocar o som
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
                log('‚úÖ Beep de notifica√ß√£o tocado com sucesso');
                return true;
            } catch (error) {
                log(`‚ùå Erro ao tocar beep: ${error.message}`);
                return false;
            }
        }

        function playNotificationSound() {
            const status = document.getElementById('audio-controls-status');
            const volume = document.getElementById('volume-control').value;
            
            log(`üîä Tocando beep de notifica√ß√£o`);
            
            // Usar Web Audio API para gerar beep
            const success = playNotificationBeep();
            
            if (success) {
                status.innerHTML = '<div class="success">‚úÖ Beep tocado com sucesso!</div>';
            } else {
                status.innerHTML = '<div class="error">‚ùå Erro ao tocar beep</div>';
            }
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                log('‚èπÔ∏è √Åudio parado');
            }
        }

        function testCompleteNotification() {
            const status = document.getElementById('complete-test-status');
            log('üß™ Testando notifica√ß√£o completa...');
            
            // Testar notifica√ß√£o do navegador
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('Teste Completo', {
                    body: 'Testando som e notifica√ß√£o juntos!',
                    icon: '/vite.svg',
                    silent: false
                });
                log('üîî Notifica√ß√£o do navegador enviada');
            }
            
            // Testar som
            playNotificationSound();
            
            // Testar t√≠tulo
            testTitleNotification();
            
            status.innerHTML = '<div class="success">‚úÖ Teste completo executado!</div>';
        }

        function testTitleNotification() {
            const status = document.getElementById('title-test-status');
            const originalTitle = document.title;
            const notificationTitle = 'üîî Teste de Notifica√ß√£o no T√≠tulo';
            
            document.title = notificationTitle;
            log(`üìù T√≠tulo alterado: ${notificationTitle}`);
            
            setTimeout(() => {
                document.title = originalTitle;
                log('üìù T√≠tulo restaurado');
            }, 3000);
            
            status.innerHTML = '<div class="success">‚úÖ T√≠tulo alterado por 3 segundos!</div>';
        }

        // Atualizar display do volume
        document.getElementById('volume-control').addEventListener('input', function() {
            const volume = this.value;
            document.getElementById('volume-display').textContent = `${Math.round(volume * 100)}%`;
            log(`üîä Volume ajustado: ${Math.round(volume * 100)}%`);
        });

        // Inicializar
        log('üöÄ P√°gina de teste de √°udio carregada');
        checkAudioSupport();
    </script>
</body>
</html> 